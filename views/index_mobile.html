<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>神之遗迹2企业内部发布渠道</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="static/img/favicon_16.ico"/>
    <link rel="bookmark" href="static/img/favicon_16.ico"/>
    <!-- site css -->
    <link rel="stylesheet" href="static/css/site.min.css">

    <script type="text/javascript" src="static/js/site.min.js"></script>
  </head>
  <body>
    <!--nav-->
    <nav role="navigation" class="navbar navbar-custom">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button data-target="#menu1" data-toggle="collapse" class="navbar-toggle" type="button">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a href="#" class="navbar-brand">  <img src="static/img/dh.png"></img></a>

          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu1">
                                <ul class="nav navbar-nav  navbar-right">
                                   <li class="active"><a href="javascript:;" id="zuixin">最新</a></li>
                                   <li class="divider"></li>
                                   <li class="active"><a href="javascript:;" id="fabu">发布</a></li>
                                   <li class="divider"></li>
                                   <li class="active"><a href="javascript:;" id="kaifa">开发</a></li>
                                </ul>
              
                               
          </div>
       
        </div><!-- /.container-fluid -->
      </nav>
    <!--header-->
    <div class="container-fluid">
    <!--documents-->
        <div class="row row-offcanvas ">
       
          <div class="col-xs-12 col-sm-9 content">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title" id="panel_title">>>最新构建</h3>
              </div>
              <div class="panel-body " >
              <!-- 最新 的页面 start -->
                <div class="content-row" id="zuixin_content" >
                  <div class="col-md-6" >
                      <div class="panel">
                        <ul id="myTab1" class="nav nav-tabs nav-justified">
                          <li class="active"><a href="#release" data-toggle="tab">发布</a></li>
                          <li><a href="#dev" data-toggle="tab">开发</a></li>
                         
                        </ul>
                        <div id="myTabContent" class="tab-content">
                          <div class="tab-pane fade active in" id="release">
                            <div class="col-sm-6 col-md-6">
                              <h3 id="release_no" style="display: none;">暂无</h3>
                              <div class="thumbnail" id="release_has" style="display: none;">
                            
                                <div class="caption text-center">
                                  <h3>渠道</h3>
                                  <p id="release_channel"></p>
                                  <h3>环境</h3>
                                  <p id="release_pl_env"></p>
                                  <h3>版本</h3>
                                  <p id="release_version"></p>
                                  <h3>时间</h3>
                                  <p id="release_time"></p>
                                  <h3>描述</h3>
                                  <p id="release_desc"></p>
                                  <p ><a id="release_down" href="#" class="btn btn-warning" role="button">下载</a>  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="tab-pane fade" id="dev">
                             <div class="col-sm-6 col-md-6" >
                              <h3 id="dev_no" style="display: none;">暂无</h3>
                              <div class="thumbnail" id="dev_has" style="display: none;">
                              
                                <div class="caption text-center">
                                  <h3>渠道</h3>
                                  <p id="dev_channel"></p>
                                  <h3>环境</h3>
                                  <p id="dev_pl_env"></p>
                                  <h3>版本</h3>
                                  <p id="dev_version"></p>
                                  <h3>时间</h3>
                                  <p id="dev_time"></p>
                                  <h3>描述</h3>
                                  <p id="dev_desc"></p>
                                  <p ><a id="dev_down" href="#"  class="btn btn-success" role="button">下载</a> </p>
                                </div>
                              </div>
                            </div>
                          </div>
                      
                        </div>
                      </div>
                    </div>
                </div>
                  <!-- 最新 的页面 end-->
                  <!-- 开发 的页面 start-->
                  <div class="content-row" id="kaifa_content"  style="display: none;">
                    
                    <hide>
                    <div class="row">
                      <div class="col-md-6">
                      <div class="panel-group panel-group-lists" id="kaifa_panel_list">
                        
                     
                      </div>
                    </div>
                    </div>
                     <div class="row content-row-pagination" id="kaifa_page" style="display: none;">
                     <div class="hidden"><input type="text" id="kaifa_page" value="0"><input type="text" id="kaifa_total_page" value="0"></div>
                        <div class="col-md-12">
                          <ul class="pager">
                            <li class="previous" id="kaifa_pervious" style="display: none;"><a href="#">上一页</a></li>
                            <li class="next"><a href="#" id="kaifa_next" style="display: none;">下一页</a></li>
                          </ul>
                        </div>
                      </div>
                </div>    
                <!-- 开发 的页面 end-->
                <!-- 发布 的页面 start-->
                 <div class="content-row" id="fabu_content"  style="display: none;">
              
                    <div class="row">
                      <div class="col-md-6">
                      <div class="panel-group panel-group-lists" id="fabu_panel_list">
                        
                     
                      </div>
                    </div>
                    </div>
                     <div class="row content-row-pagination" id="fabu_page" style="display: none;">
                     <div class="hidden"><input type="text" id="fabu_page"value="0"><input type="text" id="fabu_total_page" value="0"></div>
                        <div class="col-md-12">
                          <ul class="pager">
                            <li class="previous" id="fabu_pervious" style="display: none;"><a href="#">上一页</a></li>
                            <li class="next"><a href="#" id="fabu_next" style="display: none;">下一页</a></li>
                          </ul>
                        </div>
                      </div>
                </div>    
                <!-- 发布 的页面 end-->
              </div><!-- panel body -->
            </div>
        </div><!-- content -->
      </div>
    </div>
  
   
    </div>
  </body>
</html>

 
<script type="text/javascript">
    kaifa();
    initpage();
    zuixin();
    kaifaPervious();
    kaifaNext();
    fabu();
    fabuNext();
    fabuPervious();

   function initpage() {
    reqZuixin();
   }
   function zuixin() {
      $("#zuixin").click(function(){
        $("#panel_title").text("<<最新构建")
         reqZuixin();
        $('#menu1').removeClass('in');
        });
   }
  function reqZuixin() {
     $('#kaifa_content').hide();
      $('#zuixin_content').show();
     $('#fabu_content').hide();
    $.ajax({
        type: 'GET',
        url: 'api/last',
        success: function (data) {
            var code=data.code;
            if(code!=0){

              return
            }
            var hasRe=false;
            var hasDev=false;
            $.each(data.items, function (index, item) {
              
                var channel =item.channel;
                var env =item.environment;
                var platform=item.platform;
                if (env=="dev") {
                  
                    hasDev=true;
                    $('#dev_has').show();
                    $('#dev_channel').text(channel);
                    $('#dev_pl_env').text(env);
                    $('#dev_time').text(item.time);
                    $('#dev_version').text(item.version);
                    $('#dev_desc').text(item.description);
                   
                    if (item.down=="") {
                      $('#dev_down').unbind('click')
                       $('#dev_down').text('失效')
                    }else{
                      if(platform=="ios"){
 
                        var down="itms-services://?action=download-manifest&url="+item.down 
                        
                        $('#dev_down').attr('href', down);
                      }else{
                         $('#dev_down').attr('href', item.down);
                      }
                     
                    }
                } else if (env=="release") {
                  hasRe=true;
                   
                    $('#release_has').show();
                   
                    $('#release_channel').text(channel);
                    $('#release_pl_env').text(env);
                    $('#release_version').text(item.version);
                    $('#release_time').text(item.time);
                    $('#release_desc').text(item.description);
                    if (item.down=="") {
                      $('#release_down').unbind('click')
                       $('#release_down').text('失效')
                    }else{
                      if(platform=="ios"){

                        var down="itms-services://?action=download-manifest&url="+item.down 
                      
                        $('#release_down').attr('href', down);
                      }else{
                         $('#release_down').attr('href', item.down);
                      }
                     
                    }
                    
                }
            });
       
            if (!hasDev){
                $('#dev_no').show();
            }
             if (!hasRe){
                $('#release_no').show();
            }
        }
       
    });
  }
 
  function kaifa() {
       $("#kaifa").click(function(){
        $("#panel_title").text("<<开发版历史记录")
           $('#kaifa_page').val(0);
          $('#kaifa_total_page').val(0);
          reqKaifa("first");
          $('#menu1').removeClass('in');
        });
   }
    function kaifaPervious(){
        $("#kaifa_pervious").click(function(){
          reqKaifa("pervious");
        });
    }
    function kaifaNext(){

        $("#kaifa_next").click(function(){
          reqKaifa("next");
        });
    }
    function reqKaifa(status) {
          $('#kaifa_content').show();
          $('#zuixin_content').hide();
          $('#fabu_content').hide();
            var opage =$('#kaifa_page').val();
             if (!opage){
                opage=1;
             }else{
                opage=parseInt(opage);
              if(status=="pervious"){

                  opage=opage-1;
              }else{
                 opage=opage+1;
              }
             
             }
              $.ajax({
              type: 'GET',
              url: 'api/mobile/list/dev?page='+opage,
              success: function (data) {
                 var code=data.code;
                  if(code!=0){

                    return
                  }
                  var page=data.page;
                  var totalPage=data.total_page
                   $('#kaifa_panel_list').empty();
                  $.each(data.items, function (index, item) {
                    var down="#";
                    var down_str="下载";
                    var platform=item.platform

                    if (item.down!="") {
                      down= item.down;
                      down_str="下载"
                    }
                    var collapse="collapse";
                    if(index==0){
                        collapse="collapse in"
                    }
                   
                    $('#kaifa_panel_list').append('<div class="panel">'+
                          '<div class="panel-heading" >'+
                            '<h4 class="panel-title">'+
                              '<a data-toggle="collapse" data-parent="#kaifa_panel_list" href="#kaifa_panel'+index+'"><strong>'+item.channel+"</strong>&"+item.time+'</a>'+
                            '</h4>'+
                          '</div>'+

                          '<div id="kaifa_panel'+index+'" class="panel-collapse '+collapse+'">'+
                            '<div class="panel-body">'+
                              '<p><span>'+item.version+'</span> <a href="'+down+'" class="btn btn-link"><span class="badge badge-primary">'+down_str+'</span></a></p>'+
                             item.description+
                            '</div>'+
                          '</div>'+
                        '</div>')
                         
                  });
    
                  if (totalPage>=1){
                      $('#kaifa_page').show();
                      $('#kaifa_page').val(page);
                      $('#kaifa_total_page').val(totalPage);
                      
                      if(page==1){
                           $('#kaifa_pervious').hide();
                      }else{
                         $('#kaifa_pervious').show();
                      }
                       if(page==totalPage){
                           $('#kaifa_next').hide();
                      }else{
                         $('#kaifa_next').show();
                      }
                  }
                   
              }
             
          });
    }
   function fabu() {
       $("#fabu").click(function(){
           $("#panel_title").text("<<发布版历史记录")
          $('#fabu_page').val(0);
          $('#fabu_total_page').val(0);
          reqFabu("fiirt");
           $('#menu1').removeClass('in');
        });
   }
    function fabuPervious(){
        $("#fabu_pervious").click(function(){
          reqFabu("pervious");
        });
    }
    function fabuNext(){
        $("#fabu_next").click(function(){
          reqFabu("next");
        });
    }

    function reqFabu(status) {
          $('#kaifa_content').hide();
          $('#zuixin_content').hide();
          $('#fabu_content').show();
            var opage =$('#fabu_page').val();
             if (!opage){
                opage=1;
             }else{
                opage=parseInt(opage);
              if(status=="pervious"){

                  opage=opage-1;
              }else{
                 opage=opage+1;
              }
             
             }
              $.ajax({
              type: 'GET',
              url: 'api/mobile/list/release?page='+opage,
              success: function (data) {
                 var code=data.code;
                  if(code!=0){

                    return
                  }
                  var page=data.page;
                  var totalPage=data.total_page
                   $('#fabu_panel_list').empty();
                  $.each(data.items, function (index, item) {
                    var down="#";
                    var down_str="失效";

                    if (item.down!="") {
                      down= item.down;
                      down_str="下载"
                    }
                    var collapse="collapse";
                    if(index==0){
                        collapse="collapse in"
                    }
                   
                    $('#fabu_panel_list').append('<div class="panel">'+
                          '<div class="panel-heading" >'+
                            '<h4 class="panel-title">'+
                              '<a data-toggle="collapse" data-parent="#fabu_panel_list" href="#fabu_panel'+index+'"><strong>'+item.channel+"</strong>&"+item.time+'</a>'+
                            '</h4>'+
                          '</div>'+

                          '<div id="fabu_panel'+index+'" class="panel-collapse '+collapse+'">'+
                            '<div class="panel-body">'+
                              '<p><span>'+item.version+'</span> <a href="'+down+' class="btn btn-link"><span class="badge badge-primary">'+down_str+'</span></a></p>'+
                             item.description+
                            '</div>'+
                          '</div>'+
                        '</div>')
                         
                  });
    
                  if (totalPage>=1){
                      $('#fabu_page').show();
                      $('#fabu_page').val(page);
                      $('#fabu_total_page').val(totalPage);
                      
                      if(page==1){
                           $('#fabu_pervious').hide();
                      }else{
                         $('#fabu_pervious').show();
                      }
                       if(page==totalPage){
                           $('#fabu_next').hide();
                      }else{
                         $('#fabu_next').show();
                      }
                  }
                   
              }
             
          });
    }

</script>