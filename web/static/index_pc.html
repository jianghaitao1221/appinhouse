<html>
  <head>
    <meta charset="utf-8">
    <title>加勒比海盗企业内部发布渠道</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="img/favicon_16.ico"/>
    <link rel="bookmark" href="img/favicon_16.ico"/>
    <!-- site css -->
    <link rel="stylesheet" href="css/site.min.css">

    <script type="text/javascript" src="js/site.min.js"></script>
    <script type="text/javascript" src="js/inhouse.js"></script>
    <script type="text/javascript" src="js/timezone.js"></script>
      <script type="text/javascript" src="js/alert.js"></script>
  </head>
  <body>
    <!--nav-->
    <nav role="navigation" class="navbar navbar-custom">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button data-target="#menu2" data-toggle="collapse" class="navbar-toggle" type="button">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a href="#" class="navbar-brand">  <img src="img/dh.png"></img></a>

          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu2">
                                <ul class="nav navbar-nav">
                                  <li class="active"><a href="index.html">首页</a></li>
                                  <li class="active"><a href="#"id="zuixin">最新</a></li>
                                  <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">ios <b class="caret"></b></a>
                                            <ul class="dropdown-menu" role="menu">
                                      
                                              <li><a href="#" id="menu_ios_release">发布</a></li>
                                              <li class="divider"></li>
                                              <li><a href="#"  id="menu_ios_dev">开发</a></li>
                                             
                                            </ul>
                                  </li>
                                   <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">android <b class="caret"></b></a>
                                            <ul class="dropdown-menu" role="menu">
                                      
                                              <li><a href="#" id="menu_android_release">发布</a></li>
                                              <li class="divider"></li>
                                              <li><a href="#"  id="menu_android_dev">开发</a></li>
                                             
                                            </ul>
                                  </li>
                                </ul>
                               
          </div>
    
        </div><!-- /.container-fluid -->
      </nav>
    <!--header-->
    <div class="container-fluid">
    <!--documents-->
        <div class="row row-offcanvas row-offcanvas-left">
        <div class="hidden"><input type="text" id="app"value=""></div>
          <div class="col-xs-12 col-sm-9 content">
            <div class="panel panel-default">
              <div class="panel-heading">
                  <h3 class="panel-title"id="panel_title1">>>最新构建</h3>
              </div>
              <div class="panel-body " >

                <div class="content-row">
                  <div id="alert_msg"></div>
                  <div class="row" id="zuixin_row">
                 
                    <div class="col-sm-6 col-md-3">
                      <div class="thumbnail">
                      
                        <div class="caption text-center" id="thumbnail_ios_release" style="display: none;">
                          <h3>平台</h3>
                          <p id="ios_release_platform"></p>
                          <h3>环境</h3>
                          <p id="ios_release_env"></p>
                          <h3>渠道</h3>
                          <p id="ios_release_channel"></p>
                          <h3>版本</h3>
                          <p id="ios_release_version"></p>
                          <h3>固定链接</h3>
                          <p>
                            <a id="ios_release_permalink" href="#">查看</a> 
                          </p>
                          <h3>时间</h3>
                          <p id="ios_release_time"></p>
                          <h3>构建url</h3>
                          <p> <a id="ios_release_url" href="#" >传送门</a>  
                          </p>
                          <h3>描述</h3>
                          <p id="ios_release_desc"></p>
                          <p><a id="ios_release_down" href="#" class="btn btn-primary" role="button">下载</a>  
                          </p>
                          <h3>更多下载地址</h3>
                          <p id="ios_release_extend_downs"></p>
                        </div>
                         <div class="caption text-center"  id="thumbnail_ios_release_none" style="display: none;">
                          <h3>平台</h3>
                          <p>ios</p>
                           <h3>环境</h3>
                          <p>release</p>
                          <p><a  class="btn btn-danger btn-block" role="button">暂无</a> </p>
                        
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                      <div class="thumbnail">
                        <div class="caption text-center" id="thumbnail_ios_dev" style="display: none;">
                          <h3>平台</h3>
                          <p id="ios_dev_platform"></p>
                          <h3>环境</h3>
                          <p id="ios_dev_env"></p>
                          <h3>渠道</h3>
                          <p id="ios_dev_channel"></p>
                          <h3>版本</h3>
                          <p id="ios_dev_version"></p>
                          <h3>固定链接</h3>
                          <p>
                             <a id="ios_dev_permalink" href="#">查看</a> 
                          </p>
                          <h3>时间</h3>
                          <p id="ios_dev_time"></p>
                          <h3>构建url</h3>
                          <p ><a id="ios_dev_url" href="#" >传送门</a>  
                          </p>
                          <h3>描述</h3>
                          <p id="ios_dev_desc"></p>
                          <p><a id="ios_dev_down" href="#" class="btn btn-success" role="button">下载</a>  
                          </p>
                          <h3>更多下载地址</h3>
                          <p id="ios_dev_extend_downs"></p>
                        </div>
                         <div class="caption text-center"  id="thumbnail_ios_dev_none" style="display: none;">
                          <h3>平台</h3>
                          <p>ios</p>
                           <h3>环境</h3>
                          <p>dev</p>
                          <p><a  class="btn btn-danger btn-block" role="button">暂无</a> </p>
                        
                        </div>
                      </div>
                    </div>
                   <div class="col-sm-6 col-md-3">
                      <div class="thumbnail">
                      
                        <div class="caption text-center" id="thumbnail_android_release" style="display: none;">
                          <h3>平台</h3>
                          <p id="android_release_platform"></p>
                          <h3>环境</h3>
                          <p id="android_release_env"></p>
                          <h3>渠道</h3>
                          <p id="android_release_channel"></p>
                          <h3>版本</h3>
                          <p id="android_release_version"></p>
                          <h3>固定链接</h3>
                          <p>
                             <a id="android_release_permalink" href="#">查看</a> 
                          </p>
                          <h3>时间</h3>
                          <p id="android_release_time"></p>
                           <h3>构建url</h3>
                          <p ><a id="android_release_url" href="#" >传送门</a>  
                          </p>
                          <h3>描述</h3>
                          <p id="android_release_desc"></p>
                          <p><a id="android_release_down" href="#" class="btn btn-info" role="button">下载</a>  
                          </p>
                          <h3>更多下载地址</h3>
                          <p id="android_release_extend_downs"></p>
                        </div>
                         <div class="caption text-center"  id="thumbnail_android_release_none" style="display: none;">
                          <h3>平台</h3>
                          <p>android</p>
                           <h3>环境</h3>
                          <p>release</p>
                          <p><a  class="btn btn-danger btn-block" role="button">暂无</a> </p>
                        
                        </div>
                      </div>
                    </div>
                     <div class="col-sm-6 col-md-3">
                      <div class="thumbnail">
                      
                        <div class="caption text-center" id="thumbnail_android_dev" style="display: none;">
                          <h3>平台</h3>
                          <p id="android_dev_platform"></p>
                          <h3>环境</h3>
                          <p id="android_dev_env"></p>
                          <h3>渠道</h3>
                          <p id="android_dev_channel"></p>
                          <h3>版本</h3>
                          <p id="android_dev_version"></p>
                          <h3>固定链接</h3>
                          <p>
                             <a id="android_dev_permalink" href="#">查看</a> 
                          </p>
                          <h3>时间</h3>
                          <p id="android_dev_time"></p>
                          <h3>构建url</h3>
                          <p > <a id="android_dev_url" href="#" >传送门</a>  
                          </p>
                          <h3>描述</h3>
                          <p id="android_dev_desc"></p>
                          <p><a id="android_dev_down" href="#" class="btn btn-warning" role="button">下载</a>  
                          </p>
                          <h3>更多下载地址</h3>
                          <p id="android_dev_extend_downs"></p>
                        </div>
                         <div class="caption text-center"  id="thumbnail_android_dev_none" style="display: none;">
                          <h3>平台</h3>
                          <p>android</p>
                           <h3>环境</h3>
                          <p>dev</p>
                          <p><a  class="btn btn-danger btn-block" role="button">暂无</a> </p>
                        
                        </div>
                      </div>
                    </div>
                  </div>
                   <div class="row" id="list_row" style="display: none;">
                    <div class="hidden"><input type="text" id="platform"value="ios"><input type="text" id="env" value="release"></div>
                     <div class="bs-example">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>时间</th>
                            <th>平台</th>
                            <th>环境</th>
                            <th>渠道</th>
                            <th>版本</th>
                            <th>描述</th>
                            <th>固定链接</th>
                            <th>构建url</th>
                            <th>下载</th>
                            <th>&nbsp;&nbsp;&nbsp;更多下载地址</th>
                          </tr>
                        </thead>
                        <tbody id="list_body">
                         
                        </tbody>
                      </table>
                    </div>
                       <div class="row content-row-pagination" id="list_page" style="display: none;">
                         <div class="hidden"><input type="text" id="page"value="0"><input type="text" id="total_page" value="0"></div>
                            <div class="col-md-12">
                              <ul class="pager">
                                <li class="previous" id="page_pervious" style="display: none;"><a href="#">上一页</a></li>
                                <li class="next"><a href="#" id="page_next" style="display: none;">下一页</a></li>
                              </ul>
                            </div>
                          </div>
                   </div>
                 
                </div>
              </div><!-- panel body -->
            </div>
        </div><!-- content -->
      </div>
    </div>
  
   
    </div>
  </body>
</html>
<script type="text/javascript">
   var toffset=getTimeOffset()

   var app=getQueryString("app")
   initpage();
   zuixin();
   menu_android_release();
   menu_ios_dev();
   menu_android_dev();
   menu_ios_release();
   page_next();
   page_pervious();

   function initpage() {

    reqZuixin();
   }
    function zuixin() {
      $("#zuixin").click(function(){
        $('#list_row').hide();
        $('#zuixin_row').show();
 
        $("#panel_title1").text(">>"+app+">>最新构建");
      
         reqZuixin();
        $('#menu2').removeClass('in');
        });
   }
    function page_pervious() {
      $("#page_pervious").click(function(){
         reqList("pervious")
        });
   }
    function page_next() {
      $("#page_next").click(function(){
         reqList("next")
        });
   }
    function menu_ios_release() {
      $("#menu_ios_release").click(function(){
        $('#page').val(0);
        $('#total_page').val(0);
        $("#panel_title1").text(">>"+app+">>ios的release历史版本");
        $('#env').val("release");
        $('#platform').val("ios");
        reqList("first")
        $('#menu2').removeClass('in');
        });
   }
  function menu_ios_dev() {
      $("#menu_ios_dev").click(function(){
     
        $("#panel_title1").text(">>"+app+">>ios的dev历史版本");
        $('#page').val(0);
        $('#total_page').val(0);
        $('#env').val("dev");
        $('#platform').val("ios");
        reqList("first")
        $('#menu2').removeClass('in');
        });
   }
    function menu_android_dev() {
      $("#menu_android_dev").click(function(){
        $('#page').val(0);
        $('#total_page').val(0);
        $("#panel_title1").text(">>"+app+">>android的dev历史版本");
        $('#env').val("dev");
        $('#platform').val("android");
        reqList("first")
        $('#menu2').removeClass('in');
        });
   }
    function menu_android_release() {
      $("#menu_android_release").click(function(){
        $('#page').val(0);
        $('#total_page').val(0);
        $("#panel_title1").text(">>"+app+">>android的release历史版本");
        $('#env').val("release");
        $('#platform').val("android");
        reqList("first")
        $('#menu2').removeClass('in');
        });
   }
    function reqZuixin() {
    
    $('#zuixin_row').show();
    $("#panel_title1").text(">>"+app+">>最新构建");
    $.ajax({
        type: 'GET',
        url: 'api/'+app+'/last?time_offset='+toffset,
        success: function (data) {
            var code=data.code;
            if(code!=0){
               error_msg(data.msg,3000)
              return
            }
            var hasIosRe=false;
            var hasIosDev=false;
            var hasAndroidRe=false;
            var hasAndroidDev=false;
            $.each(data.items, function (index, item) {
                var platform =item.platform;
                var env =item.environment;
                if (env=="dev") {
                    if(platform=="ios"){
                        hasIosDev=true;
                        $('#thumbnail_ios_dev').show();
                        $('#ios_dev_platform').text(platform);
                        $('#ios_dev_channel').text(item.channel);
                        $('#ios_dev_env').text(env);
                        $('#ios_dev_time').text(item.time);
              
                        $('#ios_dev_version').text(item.version);
                        $('#ios_dev_desc').text(item.description);

                        if(item.url==""){
                          $('#ios_dev_url').unbind('click')
                          $('#ios_dev_url').text('无')
                        }else{
                          $('#ios_dev_url').attr('href', item.url);
                        }
                        
                        var permalink = "info.html?app="+app+"&platform="+platform+"&environment="+env+"&version="+item.version
                        $('#ios_dev_permalink').attr('href', permalink);
                        if (item.down=="") {
                          $('#ios_dev_down').unbind('click')
                          $('#ios_dev_down').text('失效')
                        }else{
                          if(item.channel=="appstore"){
                            var down="itms-services://?action=download-manifest&url="+item.down 
                            
                            $('#ios_dev_down').attr('href', down);
                          }else{
                            $('#ios_dev_down').attr('href', item.down);
                          }
                         
                        }
                         var downs = getExtendDownsString(item) 
                            $('#ios_dev_extend_downs').empty()
                          $('#ios_dev_extend_downs').append(downs)
                    }else{
                        hasAndroidDev=true
                        $('#thumbnail_android_dev').show();
                        $('#android_dev_platform').text(platform);
                        $('#android_dev_channel').text(item.channel);
                        $('#android_dev_env').text(env);
                        $('#android_dev_time').text(item.time);
                         
                        $('#android_dev_version').text(item.version);
                        $('#android_dev_desc').text(item.description);

                        if(item.url==""){
                          $('#android_dev_url').unbind('click')
                          $('#android_dev_url').text('无')
                        }else{
                          $('#android_dev_url').attr('href', item.url);
                        }
                        var permalink = "info.html?app="+app+"&platform="+platform+"&environment="+env+"&version="+item.version
                        $('#android_dev_permalink').attr('href', permalink);
                        if (item.down=="") {
                          $('#android_dev_down').unbind('click')
                          $('#android_dev_down').text('失效')
                        }else{
                          $('#android_dev_down').attr('href', item.down);
                        }
                        var downs = getExtendDownsString(item) 
                         $('#android_dev_extend_downs').empty()
                        $('#android_dev_extend_downs').append(downs)
                    }
                } else if (env=="release") {
                  if(platform=="ios"){
                        hasIosRe=true;
                        $('#thumbnail_ios_release').show();
                        $('#ios_release_platform').text(platform);
                        $('#ios_release_channel').text(item.channel);
                        $('#ios_release_env').text(env);
                        $('#ios_release_time').text(item.time);
                 
                        $('#ios_release_version').text(item.version);
                        $('#ios_release_desc').text(item.description);
                       
                        if(item.url==""){
                          $('#ios_release_url').unbind('click')
                          $('#ios_release_url').text('无')
                        }else{
                          $('#ios_release_url').attr('href', item.url);
                        }
                        var permalink = "info.html?app="+app+"&platform="+platform+"&environment="+env+"&version="+item.version
                        $('#ios_release_permalink').attr('href', permalink);
                        if (item.down=="") {
                          $('#ios_release_down').unbind('click')
                          $('#ios_release_down').text('失效')
                        }else{
                          if(item.channel=="appstore"){
                            var down="itms-services://?action=download-manifest&url="+item.down 
                            
                            $('#ios_release_down').attr('href', down);
                          }else{
                            $('#ios_release_down').attr('href', item.down);
                          }
                        }
                        var downs = getExtendDownsString(item) 
                           $('#ios_release_extend_downs').empty()
                          $('#ios_release_extend_downs').append(downs)
                    }else{
                        hasAndroidRe=true
                        $('#thumbnail_android_release').show();
                        $('#android_release_platform').text(platform);
                        $('#android_release_channel').text(item.channel);
                        $('#android_release_env').text(env);
                        $('#android_release_time').text(item.time);
                       
                        $('#android_release_version').text(item.version);
                        $('#android_release_desc').text(item.description);
                       
                        if(item.url==""){
                          $('#android_release_url').unbind('click')
                          $('#android_release_url').text('无')
                        }else{
                          $('#android_release_url').attr('href', item.url);
                        }
                        var permalink = "info.html?app="+app+"&platform="+platform+"&environment="+env+"&version="+item.version
                        $('#android_release_permalink').attr('href', permalink);
                        if (item.down=="") {
                          $('#android_release_down').unbind('click')
                          $('#android_release_down').text('失效')
                        }else{
                          $('#android_release_down').attr('href', item.down);
                        }
                        var downs = getExtendDownsString(item) 
                         $('#android_release_extend_downs').empty()
                        $('#android_release_extend_downs').append(downs)
                    }
                    
                }
            });
       
            if (!hasIosRe){
                $('#thumbnail_ios_release_none').show();
            }
             if (!hasIosDev){
                $('#thumbnail_ios_dev_none').show();
            }
            if (!hasAndroidDev){
                $('#thumbnail_android_dev_none').show();
            }
             if (!hasAndroidRe){
                $('#thumbnail_android_release_none').show();
            }
        }
       
    });
  }
    function reqList(status) {
      
          $('#list_row').show();
          $('#zuixin_row').hide();
          var opage =$('#page').val();
          var platform=$('#platform').val();
          var env=$('#env').val();
         
            if(!platform){
                platform="ios"
            }
            if(!env){
                env="release"
            }
            if (!opage){
                opage=1;
             }else{
                opage=parseInt(opage);
              if(status=="pervious"){

                  opage=opage-1;
              }else{""
                 opage=opage+1;
              }
             
             }
             var url="api/"+app+"/list/ios/release?page="+opage+"&time_offset="+toffset;

             if(platform=="ios"){
                if(env!="release"){
                  url="api/"+app+"/list/ios/dev?page="+opage+"&time_offset="+toffset;
                }
             }else{
                if(env!="release"){
                  url="api/"+app+"/list/android/dev?page="+opage+"&time_offset="+toffset;
                }else{
                  url="api/"+app+"/list/android/release?page="+opage+"&time_offset="+toffset;
                }
             }
           
              $.ajax({
              type: 'GET',
              url: url,
              success: function (data) {
              //  alert(JSON.stringify(data));
                 var code=data.code;
                  if(code!=0){
                    error_msg(data.msg,3000)
                    return
                  }
                  var page=data.page;
                  var totalPage=data.total_page
                   $('#list_body').empty();
                  $.each(data.items, function (index, item) {
                    var down="#";
                    var down_str="失效";

                    if (item.down!="") {
                      if(item.platform=="ios"){
                        if(item.channel=="appstore"){
                            down="itms-services://?action=download-manifest&url="+item.down 
                          }else{
                             down=item.down;
                          }
                      }else{
                         down=item.down;
                      }
                      down_str="下载"
                    }
                    var trclass="active"
                    if( index==0 ){
                       trclass="active"
                    }else   if( index%2==0 ){
                      if(index==2){
                         trclass="success"
                      }else if(index==4){
                         trclass="info"
                      }else if(index==6){
                         trclass="warning"
                      }else{
                          trclass="danger"
                      }

                    }else {
                      trclass=""
                    }
                    var item_url="#"
                    var url_str="无"
                    if(item.url!=""){
                      item_url=item.url
                      url_str="传送门"
                    }
                    extendDownUrls = item.extendUrls
                    var downs_str ="更多下载地址"
                    var downs = getExtendDownUrlsString(item)
                    var permalink = "info.html?app="+app+"&platform="+item.platform+"&environment="+item.environment+"&version="+item.version
                    $('#list_body').append(' <tr class="'+trclass+'">'+
                            '<td>'+item.time+'</td>'+
                            '<td>'+item.platform+'</td>'+
                            '<td>'+item.environment+'</td>'+
                            '<td>'+item.channel+'</td>'+
                            '<td>'+item.version+'</td>'+
                            '<td>'+item.description+'</td>'+
                            '<td><a href="'+permalink+'"> 查看</a></td>'+
                            '<td><a href="'+item_url+'" >'+url_str+'</a></td>'+
                            '<td><a href="'+down+'" >'+down_str+'</a></td>'+
                            '<td>' +
                              downs+
                            '</td>'+
                          '</tr>')
                  });

                  if (totalPage>=1){
                      $('#list_page').show();
                      $('#page').val(page);
                      $('#total_page').val(totalPage);
                      
                      if(page==1){
                           $('#page_pervious').hide();
                      }else{
                         $('#page_pervious').show();
                      }
                       if(page==totalPage){
                           $('#page_next').hide();
                      }else{
                         $('#page_next').show();
                      }
                  }
                   
              }
             
          });
    }
    function getExtendDownUrlsString(item) {
   
      extendDownUrls = item.extendUrls
      var downs_str ="查看"
      var downs = ""

      for(var key in extendDownUrls) {
        if(item.platform=="ios"){
          if(item.channel=="appstore"){
            downs = downs + '<a href="itms-services://?action=download-manifest&url='+extendDownUrls[key]+'">'+key+'</a><p/>'
          }else{
             downs = downs + '<a href="'+extendDownUrls[key]+'">'+key+'</a><p/>'
          }
        }else{
           downs = downs + '<a href="'+extendDownUrls[key]+'">'+key+'</a><p/>'
        }
      } 
      var version_str =item.version
      version_str = version_str.split('.').join('_')
      if (downs ==""){
        downs_str = "无"
      }
      var ret = 
                                '<div class="panel-group panel-group-lists" id="accordion'+version_str+'">' +
                                  '<div class="panel">' +
                                    '<div class="panel-heading">' +
                                      '<h4 class="panel-title">' +
                                        '<a data-toggle="collapse" data-parent="#accordion'+version_str+'" href="#collapse'+version_str + '">'+downs_str+'</a>' +
                                      '</h4>' +
                                    '</div>' +
                                    '<div id="collapse'+ version_str +'" class="panel-collapse collapse">' +
                                      '<div class="panel-body">' +
                                        downs +
                                      '</div>' +
                                    '</div>' +
                                  '</div>' +
                                '</div>' 
        return ret
     }


    function getExtendDownsString(item) {
   
      extendDownUrls = item.extendUrls
      var downs = ""
      for(var key in extendDownUrls) {
        if(item.platform=="ios"){
          if(item.channel=="appstore"){
            downs = downs + '<a href="itms-services://?action=download-manifest&url='+extendDownUrls[key]+'">'+key+'</a><p/>'
          }else{
             downs = downs + '<a href="'+extendDownUrls[key]+'">'+key+'</a><p/>'
          }
        }else{
           downs = downs + '<a href="'+extendDownUrls[key]+'">'+key+'</a><p/>'
        }
      } 
      if(downs == ""){
        downs ="无"
      }
      return downs
    }
</script>